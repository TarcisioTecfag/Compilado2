// Auto-generated mind map data
const sheetTables = [
  {
    planilha: 'Esteiras Transportadoras',
    headers: [
      'Código',
      'Descrição da Máquina',
      'Tipo de Produto',
      'Diâmetro do produto (mm)',
      'Largura do produto (mm)',
      'Altura do produto (mm)',
      'Largura da Lona (mm)',
      'Largura do Rolete (mm)',
      'Largura dos Gomos (mm)',
      'Comprimento (mm)',
      'Velocidade',
      'Área de Corte (mm)',
      'Altura do Elevador (mm)',
      'Tipo de Máquina',
    ],
    rows: [
      ['PAMQIPAU007', 'PAGINADORA ROTATIVA EM ACO INOX', 'Rótulos/Papéis/Embalagens', '-', '50-300', '-', null, '-', '-', 1500, '0—50 m/min', 430, '-', 'Automática'],
      ['PAMQGPAU055', 'ALIMENTADOR ELEVADOR DE CANECAS P/ EMPACOTADORAS', 'Grãos', '-', '-', '-', '-', '-', '-', 2100, 'Volume de Transporte: 18000 litros/h', '-', 1900, 'Automática'],
      ['PAMQESAU004', 'BC1.5M/200S ESTEIRA FIXA LONA ACO INOX C/ CONTR. VEL. - 150CMX25CMX75CM', 'Frascos, Latas, Outros', '-', '-', 'Ilimitado', 190, '-', '-', 1500, '9-30 m/min', '-', '-', 'Automática'],
      ['PAMQESMN012', 'BC1M/W300P ESTEIRA TRASP. EM LONA 1M X 30CM LARG. C/ CONTROL. VELOC.', 'Frascos, Latas, Outros', '-', '-', 'Ilimitado', 190, '-', '-', 1000, '30 m/min', '-', '-', 'Automática'],
      ['PAMQESMN016', 'BC2.5M/300S ESTEIRA TRASP. INOX EM LONA 2,5M X 30CM LARG. C/ CONTROL. VELOC.', 'Frascos, Latas, Outros', '-', '-', 'Ilimitado', 190, '-', '-', 1000, '30 m/min', '-', '-', 'Automática'],
      ['PAMQESMN020', 'BC2.5M/W300P - ESTEIRA TRASP. EM LONA C2,5M X L30CM C/ CONTROL. VELOC.', 'Frascos, Latas, Outros', '-', '-', 'Ilimitado', 190, '-', '-', 2500, '30 m/min', '-', '-', 'Automática'],
      ['PAMQESMN022', 'BC2.5M/W500P - ESTEIRA TRASP. EM LONA C2,5M X L50CM C/ CONTROL. VELOC.', 'Frascos, Latas, Outros', '-', '-', 'Ilimitado', null, '-', '-', 2500, '30 m/min', '-', '-', 'Automática'],
      ['PAMQESMN013', 'BC2.5M/W500S -  ESTEIRA TRASP. INOX  LONA C2,5M X L50CM/ACO INOX/CONTROL. VELOC.', 'Frascos, Latas, Outros', '-', '-', 'Ilimitado', null, '-', '-', 2500, '30 m/min', '-', '-', 'Automática'],
      ['PAMQESAU005', 'BTT1000 - MESA ACUMULADORA GIRATORIA 1000MM', 'Frascos', 'Ø20-100', '-', '20-150', '-', '-', '-', 1000, '0-10 rotações/min', '-', '-', 'Automática'],
      ['PAMQESMA006', 'ESTEIRA TRANSPORTADORA 1M C/ CONTROLE DE VELOC. P/ AUTOM.', 'Frascos, Latas, Outros', '-', '-', 'Ilimitado', '-', '-', null, 1000, null, '-', '-', 'Automática'],
      ['PAMQESMA004', 'RC1M/D ESTEIRA TRANSPORTADORA COM ROLETES MOTORIZADA', 'Caixas, Outros', '-', '-', 'Ilimitado', '-', 480, '-', 1000, '15 m/min', '-', '-', 'Automática'],
      ['PAMQESMA007', 'RC1M/DP ESTEIRA TRANSPORTADORA DE ROLETES ', 'Caixas, Outros', '-', '-', 'Ilimitado', '-', null, '-', 1000, '15 m/min', '-', '-', 'Automática'],
      ['PAMQESMA002', 'RC1M-ESTEIRA DE ROLETES LIVRES 1 M', 'Caixas, Outros', '-', '-', 'Ilimitado', '-', 480, '-', 1000, '15 m/min', '-', '-', 'Automática'],
      ['PAMQESAU001', 'RC2M/D-ESTEIRA TRANSPORTE DE CAIXA COM MOTOR(220V)', 'Caixas, Outros', '-', '-', 'Ilimitado', '-', 480, '-', 2000, '15 m/min', '-', '-', 'Automática'],
      ['PAMQESMA003', 'RC2M-ESTEIRA TRANSPORTE DE CAIXA', 'Caixas, Outros', '-', '-', 'Ilimitado', '-', 480, '-', 2000, '15 m/min', '-', '-', 'Automática'],
      ['PAMQSLSA077', 'ZC7200- ALIMENTADOR ELEVADOR DE PRODUTOS TIPO "Z" ', 'Grãos', '-', '-', '-', '-', '-', '-', 3500, 'Volume de Transporte: 4000-7200 litros/h', '-', 3200, 'Automática'],
    ],
  },
  {
    planilha: 'Seladoras Manuais',
    headers: [
      'Código',
      'Descrição da Máquina',
      'Tipo de Produto',
      'Material da embalagem',
      'Largura de selagem (mm)',
      'Comprimento de Selagem (mm)',
      'Tipo de Máquina',
    ],
    rows: [
      ['PAMQSLMN064', 'PCS100P - (110V) SELADORA MANUAL 100MM - PLASTICA C/ 05 UNID.', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 100, 'Manual'],
      ['PAMQSLMN065', 'PCS100P - (110V) SELADORA MANUAL 100MM - PLASTICA C/ 10 UNID.', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 100, 'Manual'],
      ['PAMQSLMN013', 'PCS100P - (110V) SELADORA MANUAL 100MM - PLASTICO ', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 100, 'Manual'],
      ['PAMQSLMN066', 'PCS100P - (220V) SELADORA MANUAL 100MM - PLASTICA C/ 05 UNID.', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 100, 'Manual'],
      ['PAMQSLMN067', 'PCS100P - (220V) SELADORA MANUAL 100MM - PLASTICA C/ 10 UNID.', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 100, 'Manual'],
      ['PAMQSLMN014', 'PCS100P - (220V) SELADORA MANUAL 100MM - PLASTICO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 100, 'Manual'],
      ['PAMQSLMN004', 'PCS200A - (110V) SELADORA MANUAL 200MM - ALUMINIO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 200, 'Manual'],
      ['PAMQSLMN002', 'PCS200I - (110V) SELADORA MANUAL 200MM - LATAO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 200, 'Manual'],
      ['PAMQSLMN021', 'PCS200I - (220V) SELADORA MANUAL 200MM - LATAO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 200, 'Manual'],
      ['PAMQSLMN016', 'PCS200M - (110V) SELADORA MANUAL C/ LAMINA DE CORTE', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 200, 'Manual'],
      ['PAMQSLMN017', 'PCS200M - (220V) SELADORA MANUAL C/ LAMINA DE CORTE ', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 200, 'Manual'],
      ['PAMQSLMN001', 'PCS200P - (110V) SELADORA MANUAL 200MM - PLASTICA', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 200, 'Manual'],
      ['PAMQSLMN060', 'PCS200P - (110V) SELADORA MANUAL 200MM - PLASTICA C/ 05 UNID.', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 200, 'Manual'],
      ['PAMQSLMN062', 'PCS200P - (110V) SELADORA MANUAL 200MM - PLASTICA C/ 10 UNID.', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 200, 'Manual'],
      ['PAMQSLMN061', 'PCS200P - (220V) SELADORA MANUAL 200MM - PLASTICA C/ 05 UNID.', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 200, 'Manual'],
      ['PAMQSLMN063', 'PCS200P - (220V) SELADORA MANUAL 200MM - PLASTICA C/ 10 UNID.', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 200, 'Manual'],
      ['PAMQSLMN015', 'PCS200P - (220V) SELADORA MANUAL 200MM - PLASTICO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 200, 'Manual'],
      ['PAMQSLMN005', 'PCS300A - (110V)  SELADORA MANUAL 300MM ESTRT. ALUMINIO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 300, 'Manual'],
      ['PAMQSLMN030', 'PCS300A - (220V)  SELADORA MANUAL 300MM ESTRT. ALUMINIO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 300, 'Manual'],
      ['PAMQSLMN003', 'PCS300I - (110V) SELADORA MANUAL 300MM - LATAO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 300, 'Manual'],
      ['PAMQSLMN022', 'PCS300I - (220V) SELADORA MANUAL 300MM - LATAO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 300, 'Manual'],
      ['PAMQSLMN018', 'PCS300M - (110V) SELADORA MANUAL C/ LAMINA DE CORTE', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 300, 'Manual'],
      ['PAMQSLMN019', 'PCS300M - (220V) SELADORA MANUAL C/ LAMINA DE CORTE', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 300, 'Manual'],
      ['PAMQSLMN023', 'PCS400A - (110V) SELADORA MANUAL 40CM - ALUMINIO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 400, 'Manual'],
      ['PAMQSLMN027', 'PCS400A - (220V) SELADORA MANUAL 40CM - ALUMINIO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 400, 'Manual'],
      ['PAMQSLMN028', 'PCS500A - (110V) SELADORA MANUAL 50CM - ALUMINIO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 500, 'Manual'],
      ['PAMQSCMN029', 'PCS500A - (220V) SELADORA MANUAL 50CM - ALUMINIO', 'Embalagens Plasticas/Filme', 'PP (Polipropileno) / PE (Polietileno', 2, 500, 'Manual'],
    ],
  },
  {
    planilha: 'Seladora de Bandeja Manual',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Produto', 'Material da embalagem', 'Largura da bobina de filme', 'Área de Corte', 'Tipo de Máquina'],
    rows: [
      ['PAMQVCSA001', 'HW-450-SELADORA PORTA PELICULA 450MM(220V)', 'Filme Alimentício', 'PE / PVC', '452 mm', '430 mm', 'Manual'],
      ['PAMQVCSA002', 'HW-550-SELADORA PORTA PELICULA 550MM(220V)', 'Filme Alimentício', 'PE / PVC', '552 mm', '530 mm', 'Manual'],
    ],
  },
  {
    planilha: 'Seladora por Indução Manual',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Produto', 'Diâmetro de selagem (mm)', 'Tipo de Máquina'],
    rows: [
      ['PAMQSLSA006', 'DGYF500A - SELADORA MANUAL POR INDUCAO (220V)', 'Frascos Plásticos', '10-70', 'Manual'],
      ['PAMQSLSA023', 'DGYF-S500C SELADORA POR INDUCAO MANUAL', 'Frascos Plásticos', '60-130', 'Manual'],
    ],
  },
  {
    planilha: 'Seladora por Indução Automática',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Produto', 'Produtividade (m/min)', 'Diâmetro de selagem (mm)', 'Altura do produto (mm)', 'Tipo de Máquina'],
    rows: [
      ['PAMQSLSA019', 'FL1500A - SELADORA CONTINUA POR INDUCAO-ACO PINTADO - 220V', 'Frascos Plásticos', '0-10', 'Ø20-50', '40-200', 'AUTOMÁTICA'],
      ['PAMQSLSA001', 'FL1500S - SELADORA POR INDUCAO ACO INOX(220V)', 'Frascos Plásticos', '0-10', 'Ø20-50', '40-200', 'AUTOMÁTICA'],
      ['PAMQSLSA068', 'FL2000A - SELADORA POR INDUCAO(220V) PINTADA', 'Frascos Plásticos', '2-12', 'Ø20-130', '40-300', 'AUTOMÁTICA'],
      ['PAMQSLSA069', 'FL2000B - SELADORA POR INDUCAO MODELO DE PISO(220V)', 'Frascos Plásticos', '2-12', 'Ø40-390', '40-200', 'AUTOMÁTICA'],
      ['PAMQSLSA052', 'FL2000S - SELADORA POR INDUCAO ACO INOX(220V)', 'Frascos Plásticos', '2-12', 'Ø20-130', '40-200', 'AUTOMÁTICA'],
      ['PAMQSLAU081', 'FL3000A - SELADORA DE INDUCAO REFRIGERADA A AGUA', 'Frascos Plásticos', '0-300 frascos/min', 'Ø15-120', null, 'AUTOMÁTICA'],
    ],
  },
  {
    planilha: 'Seladoras Bundling Semi Automática',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Embalagem', 'Material do filme', 'Largura máxima do filme (mm)', 'Produtividade', 'Tamanho máx. do empacotamento', 'Tipo de Máquina'],
    rows: [
      ['PAMQCCSA028', 'BSF-6540XLT SELADORA BUNDLING SEMI-AUT. CONJUGADA COM TUNEL 220V/60HZ/3F', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'PE / PVC / outros', 600, '8-10 pcs/min', 'C 520 x L 320 x A 350 mm', 'Automática'],
    ],
  },
  {
    planilha: 'Seladoras de Pedal',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Embalagem', 'Comprimento de selagem (mm)', 'Largura de Selagem (mm)', 'Comprimento da embalagem (mm)', 'Tipo de Máquina'],
    rows: [
      ['PAMQSLPE001', 'FRP300 - SELADORA DE PEDAL 30CM - 110V', 'Embalagens Plasticas/Filme', 300, 2, '-', 'Manual'],
      ['PAMQSLPE007', 'FRP300 - SELADORA DE PEDAL 30CM - 220V', 'Embalagens Plasticas/Filme', 300, 2, '-', 'Manual'],
      ['PAMQSLPE002', 'FRP400 - SELADORA DE PEDAL 40CM - 110V', 'Embalagens Plasticas/Filme', 400, 2, '-', 'Manual'],
      ['PAMQSLPE006', 'FRP400 - SELADORA DE PEDAL 40CM - 220V', 'Embalagens Plasticas/Filme', 400, 2, '-', 'Manual'],
      ['PAMQSLPE004', 'FRP400T-SELADORA DE SACOS PLAST. DE PEDAL 30CM (110V)', 'Embalagens Plasticas/Filme', 400, 2, '-', 'Manual'],
      ['PAMQSLPE008', 'FRP500 - SELADORA DE PEDAL 50CM - 110V', 'Embalagens Plasticas/Filme', 500, 2, '-', 'Manual'],
      ['PAMQSLPE003', 'FRP500 - SELADORA DE PEDAL 50CM - 220V', 'Embalagens Plasticas/Filme', 500, 2, '-', 'Manual'],
      ['PAMQSLPE016', 'FRP600 - SELADORA DE PEDAL 60CM - 220V', 'Embalagens Plasticas/Filme', 600, 2, '-', 'Manual'],
      ['PAMQSLPE009', 'FRP600T-SELADORA DE SACOS PLAST. DE PEDAL 60CM - 110V', 'Embalagens Plasticas/Filme', 600, 2, '-', 'Manual'],
      ['PAMQSLPE005', 'FRP600T-SELADORA DE SACOS PLAST. DE PEDAL 60CM - 220V', 'Embalagens Plasticas/Filme', 600, 2, '-', 'Manual'],
      ['PAMQSLPE011', 'FRP700 - SELADORA DE PEDAL 70CM - 110V', 'Embalagens Plasticas/Filme', 700, 2, '-', 'Manual'],
      ['PAMQSLPE010', 'FRP700 - SELADORA DE PEDAL 70CM - 220V', 'Embalagens Plasticas/Filme', 700, 2, '-', 'Manual'],
      ['PAMQSLPE012', 'FRP800 - SELADORA DE PEDAL 80CM - 110V', 'Embalagens Plasticas/Filme', 800, 2, '-', 'Manual'],
      ['PAMQSLPE013', 'FRP800 - SELADORA DE PEDAL 80CM - 220V', 'Embalagens Plasticas/Filme', 800, 2, '-', 'Manual'],
      ['PAMQSLPE015', 'FRP900 - SELADORA DE PEDAL 90CM - 110V', 'Imbalagens Plasticas/Filme', 900, 2, '-', 'Manual'],
      ['PAMQSLPE014', 'FRP900 - SELADORA DE PEDAL 90CM - 220V', 'Embalagens Plasticas/Filme', 900, 2, '-', 'Manual'],
      ['PAMQSLPE017', 'FRP1000 - SELADORA DE PEDAL - 110V ', 'Embalagens Plasticas/Filme', 1000, 2, '-', 'Manual'],
      ['PAMQSLPE018', 'FRP1000 - SELADORA DE PEDAL - 220V', 'Embalagens Plasticas/Filme', 1000, 2, '-', 'Manual'],
      ['PAMQSLAU080', 'SP600L - SELADORA PNEUMATICA PARA SACOS PESADOS', 'Embalagens plásticas', 600, 10, '150-800', 'Semiautomática'],
    ],
  },
  {
    planilha: 'Seladoras em "L"',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Produto', 'Material do filme', 'Largura máxima da bobina de filme (mm)', 'Peso máximo da bobina de filme (kg)', 'Produtividade', 'Comprimento da embalagem (mm)', 'Largura da embalagem (mm)', 'Altura da embalagem (mm)', 'Soma máx. Largura + Altura da Embalagem (mm)', 'Soma máx. Comprimento + Altura da Embalagem (mm)', 'Tipo de Máquina'],
    rows: [
      ['PAMQSLAU150', 'ASS5640 - SELADORA EM "L" AUTOMATICA', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'POF / PVC / outros', 550, 20, '30 peças/min', '50-400', '30-350', 130, 420, '500 mm', 'Automática'],
      ['PAMQSLAU040', 'BF650- SELADORA TIPO "L" C/ SELAGEM LAT. CONT. E FECH. HORIZONTAL', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'POF / PVC / outros', 600, 20, '15 m/min', 'Ilimitado', 650, 200, 850, '-', 'Automática'],
      ['PAMQSLAU052', 'BF850- SELADORA TIPO "L" C/ SELAGEM LAT. CONT. E FECH. HORIZONTAL', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'POF / PVC / outros', 800, 20, '15 m/min', 'Ilimitado', 850, 200, 1000, '-', 'Automática'],
      ['PAMQSLAU196', 'BF850/25- SELADORA TIPO "L" C/ SELAGEM LAT. CONT. E FECH. HORIZONTAL', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'POF / PVC / outros', 800, 20, '15 m/min', 'Ilimitado', 850, 250, 1050, '-', 'Automática'],
      ['PAMQSLAU048', 'BSF-5545LE SELADORA TIPO "L" - SELAGEM LATERAL CONTINUA 220V/1F', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'POF / PVC / outros', 550, 20, '25 peças/min', 'Ilimitado', 350, 150, 450, '-', 'Automática'],
      ['PAMQSLAU076', 'BSF-5640LG-E  SELADORA "L" AUTOMATICA(220V)', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'POF / PVC / outros', 550, 20, '25 peças/min', 400, 350, 150, 420, 450, 'Automática'],
      ['PAMQSLAU047', 'BSF-5640LG SELADORA "L" AUTOMATICA(220V)', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'POF / PVC / outros', 550, 20, '25 peças/min', 400, 350, 130, 420, 500, 'Automática'],
      ['PAMQSLSA010', 'FQL450A-SELADORA L SEMI AUTOMATICA(220V)', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'POF / PVC / outros', 540, 20, '10m/min', 580, 420, 250, 500, 800, 'Semiautomática'],
      ['PAMQSLAU028', 'FQL450LB - SELADORA "L" AUTOMATICA(220V)', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'POF / PVC / outros', 520, 20, '30 peças/min', 450, 320, 120, '-', '-', 'Automática'],
      ['PAMQSLAU164', 'FQL450LK - SELADORA "L" AUTOMATICA(220V) C/ "KISS BELT"', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'POF / PVC / outros', 520, 20, '20 peças/min', '100-460', '40-320', '20-100', '-', '-', 'Automática'],
      ['PAMQCCSA004', 'FQL450T-SELADORA L PNEUMATICA(220V)', 'Filme Termoencolhível (Plásticos Poliolefínicos)', 'POF / PVC / outros', 540, 20, '10 m/min', 560, 420, 250, 500, 800, 'Semiautomática'],
    ],
  },
  {
    planilha: 'Seladora a Vácuo',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Embalagem', 'Material da embalagem', 'Material do filme', 'Largura do filme (mm)', 'Diâmetro máximo do rolo de filme (mm)', 'Dimensões da embalagem (mm)', 'Produtividade', 'Comprimento da câmara (mm)', 'Largura da câmara (mm)', 'Altura da câmara (mm)', 'Comprimento de selagem (mm)', 'Largura de selagem (mm)', 'Peso máximo', 'Tipo de Máquina'],
    rows: [
      ['PAMQSLAU050', 'DZ(Q)400/2SB - SELADORA A VACUO DUPLA CAMARA 220V C/ INJ. DE GAS', 'Embalagens Plásticos', 'PA+PE (Poliamida/Nilon + Polietileno) / EVOH / PET+PE / PE, PET , PP ', '-', '-', '-', 'Depende da dimensão da câmara e o comprimento de selagem', 'Depende do tempo de vácuo', null, null, null, null, null, null, 'Semiautomática'],
      ['PAMQSLAU029', 'DZ(Q)500/2SB - SELADORA A VACUO DUPLA CAMARA 220V  C/ INJ. DE GAS', 'Embalagens Plásticos', 'PA+PE (Poliamida/Nilon + Polietileno) / EVOH / PET+PE / PE, PET , PP ', '-', '-', '-', 'Depende da dimensão da câmara e o comprimento de selagem', 'Depende do tempo de vácuo', null, null, null, null, null, null, 'Semiautomática'],
      ['PAMQVCMS025', 'DZ260B - SELADORA A VACUO DE MESA CAMARA SIMPLES', 'Embalagens Plásticos', 'PA+PE (Poliamida/Nilon + Polietileno) / EVOH / PET+PE / PE, PET , PP ', '-', '-', '-', 'Depende da dimensão da câmara e o comprimento de selagem', 'Depende do tempo de vácuo', 380, 280, 150, 260, 8, '-', 'Semiautomática'],
      ['PAMQVCMN006', 'DZ280/2SE - SELADORA PORTATIL A VACUO COM RESERV. P/ LIQUIDO-110V', 'Embalagens Plásticos', 'PA+PE (Poliamida/Nilon + Polietileno) / EVOH / PET+PE / PE, PET , PP ', '-', '-', '-', 'C ≥60 x L 30-270', 'Depende da velocidade de produção manual', '-', '-', '-', 280, 5, '-', 'Semiautomática'],
      ['PAMQVCMS014', 'DZ600/2SB - SELADORA A VACUO DUPLA CAMARA(220V)', 'Embalagens Plásticos', 'PA+PE (Poliamida/Nilon + Polietileno) / EVOH / PET+PE / PE, PET , PP ', '-', '-', '-', 'Depende da dimensão da câmara e o comprimento de selagem', 'Depende do tempo de vácuo', 600, '450 (considerando a sobra de 50mm)', 140, 600, 15, '-', 'Semiautomática'],
      ['PAMQVCSA004', 'SBV240TS - SELADORA A VACUO DE BANDEJA', 'Bandeja', 'PP, PE, PET', 'PET/CPP, PET, PE, OPP/CPP, EVOH, Folha de alumínio e outros filmes', 250, 150, 'Molde 1: C 205 x L 155\nMolde 2: C 184 x L 114 ', '100-300 bandejas/hora', 287, 208, 56, '-', '-', null, 'Semiautomática'],
      ['PAMQVCMS001', 'VM300TE/A-SELADORA A VACUO DE MESA(220V)', 'Embalagens plásticas', 'PA+PE (Poliamida/Nilon + Polietileno) / EVOH / PET+PE / PE, PET , PP ', '-', '-', '-', 'Depende da dimensão da câmara e o comprimento de selagem', 'Depende do tempo de vácuo', '380 (Considerando a sobra da embalagem)', 300, 100, 280, 8, '-', 'Semiautomática'],
      ['PAMQVCMS008', 'VM600E/B SELADORA A VACUO C/ DUPLA BARRA DE SELAGEM(220V)', 'Embalagens plásticas', 'PA+PE (Poliamida/Nilon + Polietileno) / EVOH / PET+PE / PE, PET , PP ', '-', '-', '-', 'Depende da dimensão da câmara e o comprimento de selagem', 'Depende do tempo de vácuo', 590, 620, 150, 600, 8, '-', 'Semiautomática'],
      ['PAMQSLAU064', 'FRM-980ZQ/P SELADORA CONTINUA C/ SISTEMA DE VACUO -ACO PINTADO 220V/1F', 'Embalagens plásticas', 'PE, PP, Folha de alumínio (ponto de fusão: 100-200 °C)', null, '-', '-', 'C 300 x L  ≥60', '0-13 m/min', '-', '-', '-', '-', 10, '10 kg', 'Automática'],
      ['PAMQSLAU065', 'FRM-980ZQ/S SELADORA CONTINUA C/ SISTEMA DE VACUO -ACO INOX 220V/1F', 'Embalagens plásticas', 'PE, PP, Folha de alumínio (ponto de fusão: 100-200 °C)', null, '-', '-', 'C 300 x L  ≥60', '0-13 m/min', '-', '-', '-', '-', 10, '10 kg', 'Automática'],
    ],
  },
  {
    planilha: 'Seladora Automática',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Embalagem', 'Material da embalagem', 'Largura de selagem lateral (mm)', 'Comprimento da embalagem (mm)', 'Produtividade', 'Peso máximo', 'Datador', 'Tipo de Máquina'],
    rows: [
      ['PAMQSLAU079', 'FR750W/P -  SELADORA CONTINUA (220V)', 'Embalagens plásticas', 'PE, PP, Folha de alumínio (ponto de fusão: 100-200 °C)', '10', '-', '0-13 m/min', '5 kg', 'Não possui', 'Automática'],
      ['PAMQSLAU049', 'FRD1000 LDL - (INOX)SELADORA CONT. C/IMP.TINTA SOLIDA', 'Embalagens plásticas', 'PE, PP, Folha de alumínio (ponto de fusão: 100-200 °C)', 10, '100-500', '0-13 m/min', '10 kg', 'Tinta sólida', 'Automática'],
      ['PAMQSLAU018', 'FRD1000 LW - INVERTIDA (INOX) SELAD. CONT. C/ TINTA SOLIDA', 'Embalagens plásticas', 'PE, PP, Folha de alumínio (ponto de fusão: 100-200 °C)', 10, '140-260', '0-13 m/min', '5 kg', 'Tinta sólida', 'Automática'],
      ['PAMQSLAU032', 'FRD1000 LW5 - (INOX) SELADORA CONT. C/ TINTA SOL. AREA 90MM - (220V)', 'Embalagens plásticas', 'PE, PP, Folha de alumínio (ponto de fusão: 100-200 °C)', 50, '140-260', '0-13 m/min', '5 kg', 'Tinta sólida', 'Automática'],
      ['PAMQSLAU044', 'FRM-1120LD SELADORA CONTINUA VERT. EM ACO INOX C/IMP T. SOLIDA 220V', 'Embalagens plásticas', 'PE, PP, Folha de alumínio (ponto de fusão: 100-200 °C)', 10, '100-700', '0-10 m/min', '15 kg', 'Tinta sólida', 'Automática'],
      ['PAMQSLAU062', 'FRP770W/400 - SELADORA CONTINUA C/ ESTEIRA 400MM  DE LARGURA', 'Embalagens plásticas', 'PE, PP, Folha de alumínio (ponto de fusão: 100-200 °C)', 12, '100-450', '0-10 m/min', '15 kg', 'Não possui', 'Automática'],
      ['PAMQSLAU053', 'HRS255 - SELADORA CONTINUA PARA GRAU CIRURGICO', 'Embalagens plásticas', 'PE, PP, Folha de alumínio (ponto de fusão: 100-200 °C)', 12, '-', '0-10 m/min', '-', 'Não possui', 'Semiautomática'],
      ['PAMQSLAU088', 'PRATIC SEAL TC20- SELADORA CONTINUA SEMI AUTOMATICA AZUL - 220V', 'Embalagens plásticas', 'PE, PP, e outros plásticos', 10, '-', '0-5 m/min', '-', 'Não possui', 'Semiautomática'],
      ['PAMQSLAU024', 'SF150 LW-P (ACO PINTADO) SELADORA CONTINUA (220V)', 'Embalagens plásticas', 'PE, PP, Folha de alumínio (ponto de fusão: 100-200 °C)', 10, '140-260', '0-13 m/min', '5 kg', 'Não possui', 'Automática'],
      ['PAMQSLAU022', 'SF150 W-P (ACO PINTADO) SELADORA CONTINUA (220V)', 'Embalagens plásticas', 'PE, PP, Folha de alumínio (ponto de fusão: 100-200 °C)', 10, '80-260', '0-13 m/min', '5 kg', 'Não possui', 'Automática'],
    ],
  },
  {
    planilha: 'Abastecedor Automático',
    headers: ['Código', 'Descrição da Máquina', 'Potência (W)', 'Potência de Resfriamento (W)', 'Potência do Bombeamento Interno (W)', 'BTU/hora', 'Volume - Evaporador (L)', 'Fluxo de Ar Resfriado (m³/h)', 'Fluxo de Fluído Refrigerado (m³/h)', 'Tipo de Máquina'],
    rows: [
      ['PAMQLQAU035', 'QE-A - UNIDADE RESFRIADORA/REFRIGERADORA PARA AGUA GELADA', 2270, 7200, 370, 18000, 27, 2000, '0.91', 'Automática'],
    ],
  },
  {
    planilha: 'Alimentadores Parafuso',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Produto', 'Altura (até a boca) (mm)', 'Volume do Funil (L)', 'Diâmetro da Boca (mm)', 'Tipo de Máquina'],
    rows: [
      ['PAMQGPAU080', 'ALIMENTADOR DE ROSCA PARA POS ALT. 2,5METROS  - FUNIL 110 LITROS', 'Pós', 2000, 110, 110, 'Automática'],
      ['PAMQGPAU038', 'ALIMENTADOR DE ROSCA PARA POS - FUNIL 110 LITROS', 'Pós', 1600, '110', 110, 'Automática'],
    ],
  },
  {
    planilha: 'Aplicador Manual de Stretch',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Produto', 'Diâmetro Interno Mínimo da Bobina de Filme (mm)', 'Diâmetro Externo Máximo da Bobina de Filme (mm)', 'Comprimento da Bobina de Filme (mm)', 'Produtividade', 'Tipo de Máquina'],
    rows: [
      ['PAMQSLMN024', 'E610 - APLICADOR MANUAL DE FILME STRETCH', 'Filme Stretch', 'Ø38', 'Ø76', '300-500', 'A depender da velocidade de operação', 'Manual'],
    ],
  },
  {
    planilha: 'Aplicador Automático de Stretch',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Produto', 'Diâmetro Interno Mínimo da Bobina de Filme (mm)', 'Diâmetro Externo Máximo da Bobina de Filme (mm)', 'Comprimento da Bobina de Filme (mm)', 'Área útil (Diâmetro da Plataforma Giratória) (mm)', 'Altura do Palete (mm)', 'Peso máximo do Palete (kg)', 'Produtividade', 'Tipo de Máquina'],
    rows: [
      ['PAMQSLAU058', 'BL2000A - STRECHADEIRA AUTOMATICA DE PALETES', 'Filme Stretch', null, null, 500, 'Ø1500 (personalizada para 1650, 1800 ou 2000)', 2100, 2000, '15-140 paletes/hora', 'Automática'],
      ['PAMQSLAU033', 'BL2000B - STRECHADEIRA AUTOMATICA DE PALETES', 'Filme Stretch', null, null, '500', 'Ø1500 (personalizada para 1650, 1800 ou 2000)', '2100', '2000', '15-140 paletes/hora', 'Automática'],
      ['PAMQSLAU056', 'BL2000P - STRECHADEIRA AUTOMATICA DE PALETES', 'Filme Stretch', null, null, 500, 'Ø1500 (personalizada para 1650, 1800 ou 2000)', 1800, 2000, '15-140 paletes/hora', 'Automática'],
    ],
  },
  {
    planilha: 'Arqueadora',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Produto', 'Tipo de Fita', 'Espessura da Fita (mm)', 'Largura da Fita (mm)', 'Diâmetro Interno da Bobina de Fita (mm)', 'Diâmetro Externo da Bobina de Fita (mm)', 'Largura da Bobina de Fita (mm)', 'Comprimento da Caixa (mm)', 'Largura da Caixa (mm)', 'Altura da Caixa (mm)', 'Área Útil da Máquina (mm)', 'Altura Útil da Máquina (mm)', 'Produtividade', 'Tipo de Máquina'],
    rows: [
      ['PAMQARSA009', 'XQD-25E - ARQUEADORA PNEUMATICA MANUAL', 'Fita de Arquear', 'Poliéster (PET) / PP (Polipropileno)', '0,5-1,5', '19-25', '-', '-', '-', '-', '-', '-', null, null, 'Depende do tamanho do produto e da velocidade de operação', 'Manual'],
      ['PAMQARSA008', 'XQD-19E - ARQUEADORA PNEUMATICA MANUAL', 'Fita de Arquear', 'Poliéster (PET) / PP (Polipropileno)', '0,5-1,5', '13-19', '-', '-', '-', '-', '-', '-', null, null, 'Depende do tamanho do produto e da velocidade de operação', 'Manual'],
      ['PAMQARAU009', 'MH301A - MAQUINA ARQUEADORA AUTOMATICA', 'Fita de Arquear', 'Recomendado: PP (Polipropileno)', '0,55-1', '9-15', 'Ø200-210', 'Ø400-450', '170-190', '-', '80-800', '60-600', '625 x 800', 600, 'até 2 segundos/arqueação', 'Automática'],
      ['PAMQARSA006', 'SM10H - MAQ. SEMI-AUTOM. DE ARQUEAR 220V', 'Fita de Arquear', 'Recomendado: PP (Polipropileno)', '0,55-1', '5-15', 'Ø200-210', 'Ø400-450', '170-190', '-', '150-650', '60-800', '650 x 520', 800, 'até 0,53 segundos/arqueação', 'Semiautomática'],
    ],
  },
  {
    planilha: 'Datadoras',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de produto', 'Comprimento do produto (mm)', 'Largura do produto (mm)', 'Distância de impressão (mm)', 'Altura de impressão (mm)', 'Impressão', 'Produtividade', 'Tipo de impressão', 'Resolução de Impressão', 'Tipo de Máquina'],
    rows: [
      ['PAMQIPAU008', 'MY380/M DATADOR C/ BASE AUMENTADA C/ TINTA SOLIDA E CONTADOR (INOX)', 'Rótulos/Papéis/Embalagens', '50-200', '65-230', '-', '-', '5 linhas | 15 caracteres por linha', '300 impressões/min', 'Tinta sólida', '-', 'Automática'],
      ['PAMQIPMN069', 'M6- IMPRESSORA MANUAL JATO DE TINTA COM P/ TOUCH', 'Aço/Ferro/Madeira/Vidro/Concreto/Plástico/Papel', '-', '-', '2-5', '2-12,7', '-', '70 m/min (dependade da velocidade de operação)', 'Inkjet', '300ppp', 'Manual'],
      ['PAMQIPMN065', 'HP351-DATADORA HOT STAMP MANUAL (220V) P/ POTES C/ SUPORTE DE PEDAL', 'Rótulos/Papéis/Embalagens/sacos de papel ou de plástico/ pequenas caixas', '-', '-', '-', '-', '3 linhas | 15 caracteres por linha', '(depende da velocidade de operação)', 'Fita Ribbon', '-', 'Manual'],
      ['PAMQIPMN064', 'HP351-DATADORA HOT STAMP MANUAL (110V) P/ POTES C/ SUPORTE DE PEDAL', 'Rótulos/Papéis/Embalagens/sacos de papel ou de plástico/ pequenas caixas', '-', '-', '-', '-', '3 linhas | 15 caracteres por linha', '(depende da velocidade de operação)', 'Fita Ribbon', '-', 'Manual'],
      ['PAMQIPMN040', 'MX2 - IMPRESSORA JATO DE TINTA C/ PAINEL TOUCH', 'Aço/Ferro/Madeira/Vidro/Concreto/Plástico/Papel', '-', '-', '2-5', '1-25,4', '1-6 linhas', '70 m/min', 'Inkjet', '600ppp', 'Automática'],
      ['PAMQIPMN039', 'MX1- IMPRESSORA JATO DE TINTA C/ PAINEL TOUCH', 'Aço/Ferro/Madeira/Vidro/Concreto/Plástico/Papel', '-', '-', '2-5', '1-12,7', '1-6 linhas', '70 m/min', 'Inkjet', '600ppp', 'Automática'],
      ['PAMQIPMN038', 'M7- IMPRESSORA MANUAL JATO DE TINTA COM P/ TOUCH', 'Aço/Ferro/Madeira/Vidro/Concreto/Plástico/Papel', '-', '-', '2-5', '2-12,7', '-', '70 m/min (dependade da velocidade de operação)', 'Inkjet', '600ppp', 'Manual'],
      ['PAMQIPAU004', 'MY380 DATADOR COM TINTA SOLIDA E CONTADOR (ACO PINTADO)', 'Rótulos/Papéis/Embalagens', '50-200', '65-175', '-', '-', '5 linhas | 15 caracteres por linha', '300 impressões/min', 'Tinta sólida', '-', 'Automática'],
      ['PAMQIPMN015', 'HP351-DATADORA HOT STAMP MANUAL (110V)', 'Rótulos/Papéis/Embalagens/sacos de papel ou de plástico/ pequenas caixas', '-', '-', '-', '-', '3 linhas | 15 caracteres por linha', '(depende da velocidade de operação)', 'Fita Ribbon', '-', 'Manual'],
      ['PAMQIPMN002', 'HP351-DATADORA HOT STAMP MANUAL (220V)', 'Rótulos/Papéis/Embalagens/sacos de papel ou de plástico/ pequenas caixas', '-', '-', '-', '-', '3 linhas | 15 caracteres por linha', '(depende da velocidade de operação)', 'Fita Ribbon', '-', 'Manual'],
      ['PAMQIPEL002', 'HP241C-DATADORA HOT STAMP ELETRICA (3 LINHAS)(220V)', 'Rótulos/Papéis/Embalagens/sacos de papel ou de plástico/ pequenas caixas', '-', '-', '-', '-', '3 linhas | 15 caracteres por linha', '(depende da velocidade de operação)', 'Fita Ribbon', '-', null],
      ['PAMQIPAU002', 'MY380 DATADOR COM TINTA SOLIDA E CONTADOR (INOX)', 'Rótulos/Papéis/Embalagens', '50-200', '65-175', '-', '-', '5 linhas | 15 caracteres por linha', '300 impressões/min', 'Tinta sólida', '-', 'Automática'],
    ],
  },
  {
    planilha: 'Dosadora',
    headers: ['Código', 'Descrição da Máquina', 'Tipo de Produto', 'Fluidez', 'Observação do Produto', 'Dosagem', 'Produtividade', 'Tipo de Máquina'],
    rows: [
      ['PAMQSLSA124', 'DM1000F - DOSADORA C/ BALANCA ELETR. P/ POS BX FLUIDEZ 100~1000/GRAMAS', 'Pós', 'Baixa Fluidez', 'IMPORTANTE TESTAR O PRODUTO DO CLIENTE NA MÁQUINA PARA UM RESULTADO MAIS ASSERTIVO', '100-1000 g', '10-20 embalagens/min', 'Semiautomática'],
      ['PAMQSLSA122', 'DM1000S - DOSADORA C/ BALANCA ELETR. P/ GRANULADOS 100~1000/GRAMAS', 'Granulados', 'Alta Fluidez', 'IMPORTANTE TESTAR O PRODUTO DO CLIENTE NA MÁQUINA PARA UM RESULTADO MAIS ASSERTIVO', '100-1000 g', '10-20 embalagens/min', 'Semiautomática'],
      ['PAMQSLSA125', 'DM5000F - DOSADORA C/ BALANCA ELETR. P/ POS BX FLUIDEZ 200~5000/GRAMAS', 'Pós', 'Baixa Fluidez', 'IMPORTANTE TESTAR O PRODUTO DO CLIENTE NA MÁQUINA PARA UM RESULTADO MAIS ASSERTIVO', '200-5000 g', '10-20 embalagens/min', 'Semiautomática'],
      ['PAMQSLSA123', 'DM5000S - DOSADORA C/ BALANCA ELETR. P/ GRANULADOS 200~5000/GRAMAS', 'Granulados', 'Alta Fluidez', 'IMPORTANTE TESTAR O PRODUTO DO CLIENTE NA MÁQUINA PARA UM RESULTADO MAIS ASSERTIVO', '200-5000 g', '10-20 embalagens/min', 'Semiautomática'],
      ['PAMQEVSA001', 'KFG1000-MAQUINA SEMI-AUT. P/ ENCHIM. GRAOS E FARELOS(220V)', 'Grãos e Farelos', 'Baixa/Alta Fluidez', 'IMPORTANTE TESTAR O PRODUTO DO CLIENTE NA MÁQUINA PARA UM RESULTADO MAIS ASSERTIVO', '500-1000 ml', '5-30 embalagens/min', 'Semiautomática'],
    ],
  },
];

function buildTreeFromSheets(sheets) {
  return {
    title: 'Mapa Mental Tecfag',
    detail: 'Catálogo de máquinas e acessórios organizado por categoria',
    children: sheets.map((sheet) => {
      const headers = sheet.headers || [];
      const [codeLabel, detailLabel, ...attributeLabels] = headers;
      return {
        title: sheet.planilha,
        children: sheet.rows.map((row) => {
          const [code, detail, ...attributes] = row;
          const children = attributeLabels
            .map((label, index) => {
              const value = attributes[index];
              if (value === null || value === undefined || value === '') return null;
              return { title: `${label}: ${value}` };
            })
            .filter(Boolean);
          return { title: `Código: ${code}`, detail, children };
        }),
      };
    }),
  };
}

const data = buildTreeFromSheets(sheetTables);

const mindmap = document.getElementById('mindmap');
const expandAllBtn = document.getElementById('expand-all');
const collapseAllBtn = document.getElementById('collapse-all');
const searchInput = document.getElementById('search');
function setMeasuredHeight(branch) {
  branch.style.maxHeight = "none";
  const height = branch.scrollHeight;
  branch.style.maxHeight = `${height}px`;
}

function setBranchState(branch, expand) {
  branch.classList.toggle("expanded", expand);
  branch.classList.toggle("collapsed", !expand);
  if (expand) {
    setMeasuredHeight(branch);
  } else {
    branch.style.maxHeight = "0px";
  }
}

function syncBranchHeights() {
  mindmap.querySelectorAll(".branch").forEach((branch) => {
    const isExpanded = branch.classList.contains("expanded");
    setBranchState(branch, isExpanded);
  });
}

function refreshExpandedHeights() {
  mindmap.querySelectorAll(".branch.expanded").forEach((branch) => {
    setMeasuredHeight(branch);
  });
}

let heightSyncHandle = null;
function queueHeightRefresh() {
  if (heightSyncHandle) {
    cancelAnimationFrame(heightSyncHandle);
  }
  heightSyncHandle = requestAnimationFrame(() => {
    refreshExpandedHeights();
    heightSyncHandle = null;
  });
}

function createNode(node, depth = 0) {
  const hasChildren = Array.isArray(node.children) && node.children.length > 0;
  const listItem = document.createElement("li");
  listItem.dataset.search = `${node.title} ${node.detail || ""}`.toLowerCase();
  const button = document.createElement("button");
  button.className = "toggle-button";
  button.type = "button";
  button.setAttribute("aria-expanded", hasChildren && depth === 0 ? "true" : "false");
  button.setAttribute("aria-label", node.title);

  const card = document.createElement("div");
  card.className = "node-card";

  const chevron = document.createElement("span");
  chevron.className = "chevron";
  card.appendChild(chevron);

  const bullet = document.createElement("span");
  bullet.className = "bullet";
  card.appendChild(bullet);

  const textWrapper = document.createElement("div");
  textWrapper.className = "text";

  const title = document.createElement("p");
  title.className = "node-title";
  title.textContent = node.title;
  textWrapper.appendChild(title);

  if (node.detail) {
    const detail = document.createElement("p");
    detail.className = "node-detail";
    detail.textContent = node.detail;
    textWrapper.appendChild(detail);
  }

  card.appendChild(textWrapper);
  button.appendChild(card);
  listItem.appendChild(button);

  if (hasChildren) {
    const branch = document.createElement("ul");
    const initiallyExpanded = depth === 0;
    branch.className = `branch ${initiallyExpanded ? "expanded" : "collapsed"}`;

    node.children.forEach((child) => {
      branch.appendChild(createNode(child, depth + 1));
    });

    listItem.appendChild(branch);

    button.addEventListener("click", () => {
      const isExpanded = branch.classList.contains("expanded");
      setBranchState(branch, !isExpanded);
      button.setAttribute("aria-expanded", String(!isExpanded));
      adjustAncestorHeights(branch);
      queueHeightRefresh();
    });

    button.addEventListener("keydown", (event) => {
      if (event.key === "Enter" || event.key === " ") {
        event.preventDefault();
        button.click();
      }
    });
  } else {
    button.classList.add("static");
  }

  return listItem;
}

function renderTree(rootData) {
  mindmap.innerHTML = "";
  const tree = document.createElement("ul");
  tree.className = "tree";
  tree.appendChild(createNode(rootData));
  mindmap.appendChild(tree);
}

function toggleAll(expand = true) {
  const branches = mindmap.querySelectorAll(".branch");
  branches.forEach((branch) => {
    setBranchState(branch, expand);
    const parentButton = branch.previousElementSibling;
    if (parentButton) {
      parentButton.setAttribute("aria-expanded", String(expand));
    }
  });
  queueHeightRefresh();
}

function expandAncestors(listItem) {
  let currentLi = listItem;
  while (currentLi) {
    const branch = currentLi.closest(".branch");
    if (branch) {
      setBranchState(branch, true);
      const parentButton = branch.previousElementSibling;
      if (parentButton) {
        parentButton.setAttribute("aria-expanded", "true");
      }
      currentLi = branch.parentElement?.closest?.("li") || null;
    } else {
      currentLi = null;
    }
  }
}

function resetSearchState() {
  mindmap.classList.remove("has-search");
  mindmap.querySelectorAll(".node-card").forEach((card) => {
    card.classList.remove("search-match", "search-visible");
  });
}

function applySearch(keyword) {
  const query = keyword.trim().toLowerCase();
  resetSearchState();

  if (!query) {
    queueHeightRefresh();
    return;
  }

  mindmap.classList.add("has-search");

  const listItems = mindmap.querySelectorAll("li");
  let firstMatchCard = null;

  listItems.forEach((li) => {
    const haystack = li.dataset.search || "";
    const isMatch = haystack.includes(query);

    if (isMatch) {
      const card = li.querySelector(".node-card");
      card?.classList.add("search-match", "search-visible");
      if (!firstMatchCard) {
        firstMatchCard = card;
      }
      expandAncestors(li);

      let ancestorLi = li.parentElement?.closest?.("li");
      while (ancestorLi) {
        ancestorLi.querySelector(".node-card")?.classList.add("search-visible");
        ancestorLi = ancestorLi.parentElement?.closest?.("li");
      }
    }
  });

  queueHeightRefresh();

  if (firstMatchCard) {
    firstMatchCard.scrollIntoView({ behavior: "smooth", block: "center" });
  }
}

renderTree(data);

requestAnimationFrame(syncBranchHeights);

expandAllBtn.addEventListener("click", () => toggleAll(true));
collapseAllBtn.addEventListener("click", () => toggleAll(false));
window.addEventListener("resize", refreshExpandedHeights);
searchInput?.addEventListener("input", (event) => applySearch(event.target.value));

function adjustAncestorHeights(branch) {
  let current = branch;
  while (current) {
    if (current.classList.contains("expanded")) {
      setMeasuredHeight(current);
    }
    current = current.parentElement?.closest?.(".branch") || null;
  }
}
